Easy to code LCA with O(log) per query and O(NlogN) precalculation. For O(1) query we can use rmq on euler tour.
